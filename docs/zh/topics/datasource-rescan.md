# 数据源重新扫描

默认情况下，数据源只会被扫描一次，但是Singularity提供了一个选项，可以在一定间隔之后重新扫描数据源。

```sh
singularity datasource add <type> --rescan-interval value
```

或者，你也可以手动触发重新扫描

```sh
singularity datasource rescan datasource_id
```

在重新扫描过程中，所有新文件都将被排队准备。所有已删除的文件将被忽略。

#### 文件版本控制

对于已更改的文件，新版本的文件将被排队准备，并且目录CID将被更新以使用文件的最新版本。

确定文件是否已更改的逻辑如下：

1. 如果数据源提供了文件的哈希值（如Etag），则只要哈希值发生了变化，就会创建一个新版本
2. 否则，如果数据源提供了文件的最后修改时间，只要该值发生了变化或者文件大小发生了变化，就会创建一个新版本
3. 否则，使用文件大小来判断是否应该创建一个新版本

如果在重新扫描之间多次覆盖同一个文件，仍然有可能遗漏某些文件版本。为了确保捕获所有文件版本，用户应使用[push-and-upload.md](push-and-upload.md)让Singularity知道每次更新文件的时间。